## 表达式语言

Rust 是所谓的表达式语言，在 C 语言中， if 和 swtich 是语句，它们不生成值，也不能在表达式中间使用。而在 Rust 中，if 和 match 可以生成值。

```rust
pixels[r * bounds.0 + c] =
  match escapes(Complex { re: point.0, im: point.1 }, 255) {
    None => 0,
    Some(count) => 255 - count as u8
  }

// if 表达式可用于初始化变量
let status =
  if cpu.temperature <= MAX_TEMP {
    HttpStatus::Ok
  } else {
    HttpStatus::ServerError
  }
```

这也解释了为什么 Rust 没有 C 那样的三元运算符。在 C 中， 三元运算符是一个表达式级别的类似 if 语句的东西。这在 Rust 中是多余的。if 表达式足以处理这样的场景。C 中大多数控制流工具是语句。而在 Rust 中， 它们都是表达式。

## 优先级和结合性

优先级和结合性和其他语言的概念类似，这里不在赘述，但有几个表达式在需要注意
|名称|书写方式|
|-|-|
|右开区间范围|start .. stop|
|右闭区间范围|start ..= stop|
|闭包|&#124; x, y &#124; x + y|

## 块与分号

Rust 中的块和其他语言的块概念有点差别。在 Rust 中，一个块生成一个值，并且可以在任何需要值的地方使用。以下是块表达式的一些总结：

- 使用 let 生命变量时，分号总是必需的
- 带分号的表达式：调用方法，丢弃返回值。（即此语句的是 `()`）
- 无分号的表达式，通常是块中的最后一个表达式，如果不带分号，表示 `{...;  x }`的值为 `x`。

## 声明

```rust
let name: type = expr;
```

类型和初始化代码是可选的，分号则是必需的。与 Rust 中的所有标识符一样，变量名必须以字母或下划线开头。并且只能在第一个字符之后包含数字。Rust 中的字母是广义的。包括希腊字母、带重音的拉丁字符等符合 Unicode 标准的字符，也包括中文。但是不允许使用表情符号。

我们可能看到如下的生命方式：

```rust
for line in file.lines(){
  let line = line?;
  // ...
}
```

这个 let 声明会创建一个不同类型的、新的（第二个）变量。第一个 line 变量的类型是 Result<String, io::Error>。第二个 line 变量则是 String，第二个定义会在所处代码块的其余部分代替第一个定义。这叫做 遮蔽。在 Rust 程序中很常见，等价于下面的代码

```rust
for line_result in file.lines(){
  let line = line_result?;
  // ...
}
```

块（大括号里面的区域）还可以包含语法项声明。语法项是指可以在程序或模块中的任意地方出现的声明。比如`fn`、`struct`、`use`等。

当在一个块中声明一个函数时，这个行为和 javascript 不太一致。Rust 在块内声明函数 fn 时，它的作用域是整个块，但是 fn 无法访问恰好在同一作用域内的局部变量或者参数。

```rust
fn main() {
    let a = 1;
    let b = 3;
    fn add() {
      // 程序会报错，虽然可以定义函数，但是无法使用同一作用域的变量。
      return a + b;
    }
}
```

与之相对的是闭包，这个概念大概和 javascript 中的闭包类似。
